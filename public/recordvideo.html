<!DOCTYPE html>
<html lang="en" id='html'>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />

	<link rel="stylesheet" href="recordvideo.css">
    <script type="module" src="recordvideo.js"></script>

    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
   </head>
    <body>

    <noscript>You need to enable JavaScript to run this app.</noscript>

   
    <div id="loaderWrapper" class="loader-wrapper">
      <span class="loader"><img src="Sanitizer Grey_1.gif" class="loader-inner"></span></span>
  </div>
  

    

  <div class="bg"></div>

          
 
        
        
            <input type="text" name="name" id="videoName" class="form-control" placeholder="Video name" value=""></input>
            <input type="text" name="description" id="videoDescription" class="form-control" placeholder="Video description" value=""></input>
           <main id="mainbody">
   
           
            <!-- Go to www.addthis.com/dashboard to customize your tools -->
        
              
          <button id="btnStart">START RECORDING</button><br/>
       <button id="btnStop">STOP RECORDING</button>
       <video id="vid1"  muted="muted"></video>
       <video id="vid2" controls></video>
  <div id="progress-container" class="progress">
    <div id="progress" class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar" aria-valuenow="46" aria-valuemin="0" aria-valuemax="100" style="width: 0%">&nbsp;0%
    </div>
    </div>
  <button id="uploadvideo">Upload</button>
  <div class="container" id="resultscontainer">
  
      
          <div class="row">
              <div class="col-md-12">
                <div id="results"></div>
              </div>
            </div>
        <div class="col-md-4">
      </div>
  <!-- could save to canvas and do image manipulation and saving too -->
</main> 
     
      
<div class="container" id='carosselcontainer'>
     
    <div id="myCarousel" class="carousel slide" data-interval="false">
      <!-- Indicators -->
      <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
        <li data-target="#myCarousel" data-slide-to="3"></li>
        <li data-target="#myCarousel" data-slide-to="4"></li>

      </ol>
  
      <!-- Wrapper for slides -->
      <div class="carousel-inner">
        <div class="item active">
          <img src="carosel.png" alt="Los Angeles" style="width:170%;">
          <img src="glove.png" id="glove" alt="" style="width:30%;">
          <div id="centered">  First of all, Thank you for being part of the corona monument.
            The goal of this piece is to make a database of covid related experiences and compile them all in a participatory documentary.
            The interactive film is made up of the videos the viewers send to us and everyone is welcome to participate in the film by sharing their story.
            We believe that every opinion needs to be heard and we are looking forward to hear what you have to share with us.
            </div> 
      
     </div>  
  
        <div class="item">
          <img src="handsanitiser.png" id="glove" alt="" style="width:30%;">
          <div id="centered">  To participate in the documentary, film your covid related experience or opinion
            by using the camera provided on this web page. 
            Press the record button and talk directly to the camera, preferably in English.
            Once you are finished with your recording, press stop recording and take a deep breath, you did great! 
            If you are satisfied with the video, press the share button and send it to our server.
            </div> 
          <img src="carosel.png" alt="Chicago" style="width:170%;">
        </div>
      
        <div class="item">
          <img src="handsoap.png" id="glove" alt="" style="width:30%;">
          <div id="centered">  The length of the video should be no longer than 2 minutes and it can have the tone that best suits your personality.
            You may express any opinions or events that best describe your time during the pandemic.
            A good place to start is describing your time during the restrictions, and the losses or gains it has brought to you.
            If you are a covid survivor, you can tell us about your time in isolation as we would gladly want to hear your first hand experience
            </div> 
          <img src="carosel.png" alt="New york" style="width:170%;">
        </div>

        <div class="item">
          <img src="handsyringe.png" id="glovesyringe" alt="" style="width:30%;">
          <div id="centered"> All the videos we receive are confidential and will not be sold or used publicly 
            other than in the Corona Monument documentary. 
            Please share the Corona Moument with your friends 
            and let them know about your participation in this interactive documentary.
            </div> 
          <img src="carosel.png" alt="New york" style="width:170%;">
        </div>

        <div class="item">
          <img src="button.png" id="okbutton" role='button' >
          <img src="carosel.png" alt="New york" style="width:170%;">
        </div>


      </div>
  
      <!-- Left and right controls -->
      <a class="left carousel-control" href="#myCarousel" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="right carousel-control" href="#myCarousel" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>
  

        

    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->

    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">









      <script type="text/javascript" >
        
      let constraintObj = { 
          audio: true, 
          video: { 
              facingMode: "user", 
              width: { min: 640, ideal: 1280, max: 1920 },
              height: { min: 480, ideal: 720, max: 1080 } 
          } 
      }; 
      // width: 1280, height: 720  -- preference only
      // facingMode: {exact: "user"}
      // facingMode: "environment"
      
      //handle older browsers that might implement getUserMedia in some way
      if (navigator.mediaDevices === undefined) {
          navigator.mediaDevices = {};
          navigator.mediaDevices.getUserMedia = function(constraintObj) {
              let getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
              if (!getUserMedia) {
                  return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
              }
              return new Promise(function(resolve, reject) {
                  getUserMedia.call(navigator, constraintObj, resolve, reject);
              });
          }
      }else{
          navigator.mediaDevices.enumerateDevices()
          .then(devices => {
              devices.forEach(device=>{
                  console.log(device.kind.toUpperCase(), device.label);
                  //, device.deviceId
              })
          })
          .catch(err=>{
              console.log(err.name, err.message);
          })
      }

      navigator.mediaDevices.getUserMedia(constraintObj)
      .then(function(mediaStreamObj) {
          //connect the media stream to the first video element
          let video = document.getElementById('vid1');
          if ("srcObject" in video) {
              video.srcObject = mediaStreamObj;
          } else {
              //old version
              video.src = window.URL.createObjectURL(mediaStreamObj);
          }
          
          video.onloadedmetadata = function(ev) {
              //show in the video element what is being captured by the webcam
              video.play();
          };
          
          //add listeners for saving video/audio
          let start = document.getElementById('btnStart');
          let stop = document.getElementById('btnStop');
          let vidSave = document.getElementById('vid2');
          let uploadvid = document.getElementById('uploadvideo')
          let mediaRecorder = new MediaRecorder(mediaStreamObj);
          let chunks = [];
          let blob = new Blob;
          
          start.addEventListener('click', (ev)=>{
              mediaRecorder.start();
              console.log(mediaRecorder.state);
          })
          stop.addEventListener('click', (ev)=>{
              mediaRecorder.stop();
              console.log(mediaRecorder.state);
          });
          mediaRecorder.ondataavailable = function(ev) {
              chunks.push(ev.data);
          }
          mediaRecorder.onstop = (ev)=>{
              videoblob = new Blob(chunks, { 'type' : 'video/mp4;' });
              console.log(blob);
              console.log(blob.chunks);
              chunks = [];
              console.log(chunks);

              let videoURL = window.URL.createObjectURL(videoblob);
              console.log(videoURL);

              vidSave.src = videoURL;

          }

          uploadvid.addEventListener('click', (ev)=>{


          new VimeoUpload({
              name: document.getElementById('videoName').value,
              description: document.getElementById('videoDescription').value,
              file: videoblob,
              token: "c058529c99ced7dbf77ff7c773a0522b",
              onError: function(data) {
                  showMessage('<strong>Error</strong>: ' + JSON.parse(data).error, 'danger')
              },
              onProgress: function(data) {
                  updateProgress(data.loaded / data.total)
              },
              onComplete: function(videoId, index) {
                  var url = 'https://vimeo.com/' + videoId

                  if (index > -1) {
                      /* The metadata contains all of the uploaded video(s) details see: https://developer.vimeo.com/api/endpoints/videos#/{video_id} */
                      url = this.metadata[index].link //

                      /* add stringify the json object for displaying in a text area */
                      var pretty = JSON.stringify(this.metadata[index], null, 2)

                      console.log(pretty) /* echo server data */
                  }

                  showMessage('<strong>Upload Successful</strong>: check uploaded video @ <a href="' + url + '">' + url + '</a>. Open the Console for the response details.')
              }
            }).upload()


             function showMessage(html, type) {
              /* hide progress bar */
              document.getElementById('progress-container').style.display = 'none'

              /* display alert message */
              var element = document.createElement('div')
              element.setAttribute('class', 'alert alert-' + (type || 'success'))
              element.innerHTML = html
              results.appendChild(element)
          }
          
          function handleDragOver(evt) {
          evt.stopPropagation()
          evt.preventDefault()
          evt.dataTransfer.dropEffect = 'copy'
      }

      /**
       * Updat progress bar.
       */
      function updateProgress(progress) {
          progress = Math.floor(progress * 100)
          var element = document.getElementById('progress')
          element.setAttribute('style', 'width:' + progress + '%')
          element.innerHTML = '&nbsp;' + progress + '%'
      }
      /**
       * Wire up drag & drop listeners once page loads
       */
      document.addEventListener('DOMContentLoaded', function() {
          var dropZone = document.getElementById('drop_zone')
          var browse = document.getElementById('browse')
          dropZone.addEventListener('dragover', handleDragOver, false)
          dropZone.addEventListener('drop', handleFileSelect, false)
          browse.addEventListener('change', handleFileSelect, false)
      })


  })

      })
      .catch(function(err) { 
          console.log(err.name, err.message); 
      });


      var SDown = false;
      var SUp = false;
      var VidoneDown = false;
      var VidoneUP = false;
      var Start = document.getElementById("btnStart");
      var Stop = document.getElementById("btnStop");
      var VideoRecording = document.getElementById("vid1");
      var RecordedVideo = document.getElementById("vid2");

      var StartDownFunction = (function() {
  return function() {
      if (!SDown) {
          SDown = true;
document.getElementById("btnStart").style.zIndex = "3";
document.getElementById("btnStop").style.zIndex = "4";
document.getElementById("vid1").style.zIndex = "1";
document.getElementById("vid2").style.zIndex = "0";
var SDown = false;
      }
  };
})();

Start.addEventListener("click", function() {
  StartDownFunction();
})

var StartUpFunction = (function() {
  return function() {
      if (!SUp) {
          SUp = true;
document.getElementById("btnStart").style.zIndex = "4";
document.getElementById("btnStop").style.zIndex = "3";
document.getElementById("vid1").style.zIndex = "0";
document.getElementById("vid2").style.zIndex = "1";
var SUp = false;

      }
  };
})();

Stop.addEventListener("click", function() {
  StartUpFunction();
})

</script>
 
      
     


      
      
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/websemantics/bragit/0.1.2/bragit.js"></script>
<script type="text/javascript" src="./vimeo-upload.js"></script>






<script src="jquery.min.js"></script>
  <script src="popper.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="jquery.validate.min.js"></script>

</body>

</html>
